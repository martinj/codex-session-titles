#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
HOOK="$SCRIPT_DIR/codex-title-notify"

if [[ ! -x "$HOOK" ]]; then
  echo "missing hook script: $HOOK" >&2
  exit 1
fi

TTY_PATH="$(tty 2>/dev/null || true)"
if [[ -n "$TTY_PATH" && -w "$TTY_PATH" ]]; then
  printf '\033]2;%s\007' "Codex Session" >"$TTY_PATH" || true
fi

export CODEX_TITLE_TTY="$TTY_PATH"
export CODEX_TITLE_HOME="${CODEX_TITLE_HOME:-$HOME/.codex}"
export CODEX_TITLE_RUN_ID="$(date +%s)-$$-${RANDOM}"

# Inject notify hook externally; no app changes required.
exec codex -c "notify=[\"$HOOK\"]" "$@"
